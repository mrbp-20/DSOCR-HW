# ‚ö†Ô∏è –û–¢–ß–Å–¢: –ü–†–û–ë–õ–ï–ú–ê –° –§–û–†–ú–ê–¢–û–ú IMAGES

**–î–∞—Ç–∞:** 2026-01-10, 19:17 MSK  
**–ò—Å–ø–æ–ª–Ω–∏—Ç–µ–ª—å:** –ù–∏–∫–æ–ª–∞–π  
**–°—Ç–∞—Ç—É—Å:** ‚ö†Ô∏è –¢–†–ï–ë–£–ï–¢–°–Ø –†–ï–®–ï–ù–ò–ï

---

## ‚úÖ –ß–¢–û –°–î–ï–õ–ê–ù–û

1. ‚úÖ –ò–∑–º–µ–Ω—ë–Ω —Ñ–æ—Ä–º–∞—Ç `images` —Å —Ç–µ–Ω–∑–æ—Ä–∞ –Ω–∞ —Å–ø–∏—Å–æ–∫ —Å–ø–∏—Å–∫–æ–≤
2. ‚úÖ –ó–∞–º–µ–Ω–µ–Ω—ã `None` –Ω–∞ –ø—É—Å—Ç—ã–µ —Ç–µ–Ω–∑–æ—Ä—ã (`torch.zeros_like`)
3. ‚úÖ –ö–æ–¥ —Å–∏–Ω—Ç–∞–∫—Å–∏—á–µ—Å–∫–∏ –∫–æ—Ä—Ä–µ–∫—Ç–µ–Ω
4. ‚úÖ –ò–∑–º–µ–Ω–µ–Ω–∏—è –∑–∞–∫–æ–º–º–∏—á–µ–Ω—ã

---

## ‚ùå –ü–†–û–ë–õ–ï–ú–ê

**–û—à–∏–±–∫–∞ –æ—Å—Ç–∞—ë—Ç—Å—è —Ç–∞ –∂–µ:**

```
TypeError: 'NoneType' object is not subscriptable
File: modeling_deepseekocr.py, line 403
Code: torch.sum(images[0][1]).item() != 0
```

**–≠—Ç–æ –æ–∑–Ω–∞—á–∞–µ—Ç:** `images[0]` —Å–∞–º –ø–æ —Å–µ–±–µ `None`, –∞ –Ω–µ —Å–ø–∏—Å–æ–∫.

---

## üîç –ê–ù–ê–õ–ò–ó

### –ß—Ç–æ –º—ã –¥–µ–ª–∞–µ–º

**–í `_data_collator()`:**

```python
images_list = []
for img in images:
    image_tensor = transform(img)
    empty_tensor = torch.zeros_like(image_tensor)
    image_item = [image_tensor, empty_tensor, empty_tensor]
    images_list.append(image_item)

batch = {
    'images': images_list,  # [[tensor, tensor, tensor], [tensor, tensor, tensor], ...]
    ...
}
```

### –ß—Ç–æ –æ–∂–∏–¥–∞–µ—Ç –º–æ–¥–µ–ª—å

**–í `modeling_deepseekocr.py:403`:**

```python
if sam_model is not None and (input_ids.shape[1] != 1 or self.training) and torch.sum(images[0][1]).item() != 0:
```

**–û–∂–∏–¥–∞–µ—Ç:** `images[0]` ‚Äî —ç—Ç–æ —Å–ø–∏—Å–æ–∫/–º–∞—Å—Å–∏–≤, `images[0][1]` ‚Äî –≤—Ç–æ—Ä–æ–π —ç–ª–µ–º–µ–Ω—Ç.

### –ü—Ä–æ–±–ª–µ–º–∞

–û—à–∏–±–∫–∞ –≥–æ–≤–æ—Ä–∏—Ç, —á—Ç–æ `images[0]` —ç—Ç–æ `None`, –∑–Ω–∞—á–∏—Ç —Å–ø–∏—Å–æ–∫ —Å–ø–∏—Å–∫–æ–≤ **–Ω–µ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –º–æ–¥–µ–ª–∏** –∏–ª–∏ **–ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç—Å—è** –≥–¥–µ-—Ç–æ –≤ –ø—É—Ç–∏.

---

## ü§î –í–û–ó–ú–û–ñ–ù–´–ï –ü–†–ò–ß–ò–ù–´

1. **DataLoader –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç —Å–ø–∏—Å–æ–∫ —Å–ø–∏—Å–∫–æ–≤** ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, DataLoader –Ω–µ –º–æ–∂–µ—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ –æ–±—Ä–∞–±–æ—Ç–∞—Ç—å –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Å–ø–∏—Å–∫–∏
2. **Trainer –ø—Ä–µ–æ–±—Ä–∞–∑—É–µ—Ç –¥–∞–Ω–Ω—ã–µ** ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å, Trainer –∫–∞–∫-—Ç–æ –∏–∑–º–µ–Ω—è–µ—Ç —Ñ–æ—Ä–º–∞—Ç –¥–∞–Ω–Ω—ã—Ö
3. **–ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç** ‚Äî –º–æ–∂–µ—Ç –±—ã—Ç—å, –º–æ–¥–µ–ª—å –æ–∂–∏–¥–∞–µ—Ç –Ω–µ —Å–ø–∏—Å–æ–∫ —Å–ø–∏—Å–∫–æ–≤, –∞ –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç
4. **–ü—Ä–æ–±–ª–µ–º–∞ –≤ –º–æ–¥–µ–ª–∏** ‚Äî –≤–æ–∑–º–æ–∂–Ω–æ, –µ—Å—Ç—å –±–∞–≥ –≤ –∫–æ–¥–µ –º–æ–¥–µ–ª–∏ DeepSeek-OCR

---

## üí° –†–ï–ö–û–ú–ï–ù–î–ê–¶–ò–ò

### –í–∞—Ä–∏–∞–Ω—Ç 1: –ü—Ä–æ–≤–µ—Ä–∏—Ç—å, —á—Ç–æ –∏–º–µ–Ω–Ω–æ –¥–æ—Ö–æ–¥–∏—Ç –¥–æ –º–æ–¥–µ–ª–∏

–î–æ–±–∞–≤–∏—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ –≤ `compute_loss()`:

```python
def compute_loss(self, model, inputs, return_outputs=False):
    images = inputs.get("images")
    print(f"DEBUG: images type: {type(images)}")
    print(f"DEBUG: images[0] type: {type(images[0]) if images else 'None'}")
    print(f"DEBUG: images[0] value: {images[0] if images else 'None'}")
    ...
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –º–æ–¥–µ–ª–∏

–ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å, –∫–∞–∫ –º–æ–¥–µ–ª—å –∏—Å–ø–æ–ª—å–∑—É–µ—Ç `images` –≤ –¥—Ä—É–≥–∏—Ö –º–µ—Å—Ç–∞—Ö –∫–æ–¥–∞. –ú–æ–∂–µ—Ç –±—ã—Ç—å, –µ—Å—Ç—å –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –≤ –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω–æ–º —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏.

### –í–∞—Ä–∏–∞–Ω—Ç 3: –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –¥—Ä—É–≥–æ–π —Ñ–æ—Ä–º–∞—Ç

–ú–æ–∂–µ—Ç –±—ã—Ç—å, –Ω—É–∂–Ω–æ –ø–µ—Ä–µ–¥–∞–≤–∞—Ç—å `images` –Ω–µ –∫–∞–∫ —Å–ø–∏—Å–æ–∫ —Å–ø–∏—Å–∫–æ–≤, –∞ –∫–∞–∫ —á—Ç–æ-—Ç–æ –¥—Ä—É–≥–æ–µ (–Ω–∞–ø—Ä–∏–º–µ—Ä, —Å–ª–æ–≤–∞—Ä—å –∏–ª–∏ NamedTuple).

---

## üìä –°–õ–ï–î–£–Æ–©–ò–ï –®–ê–ì–ò

1. –ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å –∏—Å—Ö–æ–¥–Ω—ã–π –∫–æ–¥ –º–æ–¥–µ–ª–∏ DeepSeek-OCR
2. –î–æ–±–∞–≤–∏—Ç—å –æ—Ç–ª–∞–¥–æ—á–Ω—ã–π –≤—ã–≤–æ–¥ –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –æ—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–µ –ø—Ä–∏–º–µ—Ä—ã –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è –º–æ–¥–µ–ª–∏
4. –í–æ–∑–º–æ–∂–Ω–æ, –ø–æ—Ç—Ä–µ–±—É–µ—Ç—Å—è –ø–æ–º–æ—â—å –°–µ–º—ë–Ω–∞ –¥–ª—è –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏—è API –º–æ–¥–µ–ª–∏

---

**–í—Ä–µ–º—è —Ä–∞–±–æ—Ç—ã:** ~15 –º–∏–Ω—É—Ç  
**–ò—Ç–æ–≥:** ‚ö†Ô∏è –¢—Ä–µ–±—É–µ—Ç—Å—è –¥–∞–ª—å–Ω–µ–π—à–µ–µ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ñ–æ—Ä–º–∞—Ç–∞ –¥–∞–Ω–Ω—ã—Ö
