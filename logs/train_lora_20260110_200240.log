2026-01-10 20:02:40 - train_lora - INFO - ================================================================================
2026-01-10 20:02:40 - train_lora - INFO - Запуск обучения LoRA
2026-01-10 20:02:40 - train_lora - INFO - ================================================================================
2026-01-10 20:02:40 - train_lora - INFO - Конфигурация загружена из configs\training_config.yaml
2026-01-10 20:02:40 - train_lora - INFO - 
================================================================================
2026-01-10 20:02:40 - train_lora - INFO - Шаг 1/5: Загрузка модели и процессора...
2026-01-10 20:02:40 - train_lora - INFO - ================================================================================
2026-01-10 20:02:40 - train_lora - INFO - Загрузка модели и процессора...
2026-01-10 20:02:41 - train_lora - INFO - Процессор загружен: deepseek-ai/DeepSeek-OCR (revision: 9f30c71f441d010e5429c532364a86705536c53a)
2026-01-10 20:02:52 - train_lora - INFO - Модель загружена: deepseek-ai/DeepSeek-OCR (revision: 9f30c71f441d010e5429c532364a86705536c53a)
2026-01-10 20:02:52 - train_lora - INFO - OK Шаг 1 завершён
2026-01-10 20:02:52 - train_lora - INFO - 
================================================================================
2026-01-10 20:02:52 - train_lora - INFO - Шаг 2/5: Настройка LoRA...
2026-01-10 20:02:52 - train_lora - INFO - ================================================================================
2026-01-10 20:02:52 - train_lora - INFO - Настройка LoRA...
2026-01-10 20:02:52 - train_lora - INFO - Оборачиваем модель для совместимости с PEFT...
2026-01-10 20:02:59 - train_lora - INFO - LoRA настроен успешно
2026-01-10 20:02:59 - train_lora - INFO - OK Шаг 2 завершён
2026-01-10 20:02:59 - train_lora - INFO - 
================================================================================
2026-01-10 20:02:59 - train_lora - INFO - Шаг 3/5: Подготовка датасетов...
2026-01-10 20:02:59 - train_lora - INFO - ================================================================================
2026-01-10 20:02:59 - train_lora - INFO - Подготовка датасетов...
2026-01-10 20:02:59 - train_lora - INFO - Загружено train: 3, val: 1 образцов
2026-01-10 20:02:59 - train_lora - INFO - Датасеты подготовлены
2026-01-10 20:02:59 - train_lora - INFO - OK Шаг 3 завершён
2026-01-10 20:02:59 - train_lora - INFO - 
================================================================================
2026-01-10 20:02:59 - train_lora - INFO - Шаг 4/5: Создание Trainer...
2026-01-10 20:02:59 - train_lora - INFO - ================================================================================
2026-01-10 20:02:59 - train_lora - INFO - Создание Trainer...
2026-01-10 20:02:59 - train_lora - INFO - Trainer создан
2026-01-10 20:02:59 - train_lora - INFO - OK Шаг 4 завершён
2026-01-10 20:02:59 - train_lora - INFO - 
================================================================================
2026-01-10 20:02:59 - train_lora - INFO - Шаг 5/5: ЗАПУСК ОБУЧЕНИЯ!
2026-01-10 20:02:59 - train_lora - INFO - ================================================================================
2026-01-10 20:02:59 - train_lora - INFO - ================================================================================
2026-01-10 20:02:59 - train_lora - INFO - Начало обучения
2026-01-10 20:02:59 - train_lora - INFO - ================================================================================
2026-01-10 20:03:01 - train_lora - ERROR - Ошибка обучения: Input type (float) and bias type (struct c10::Half) should be the same
Traceback (most recent call last):
  File "C:\DSOCR-HW\utils\trainer.py", line 508, in train
    self.trainer.train()
  File "C:\DSOCR-HW\venv\Lib\site-packages\transformers\trainer.py", line 2052, in train
    return inner_training_loop(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\transformers\trainer.py", line 2388, in _inner_training_loop
    tr_loss_step = self.training_step(model, inputs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\transformers\trainer.py", line 3485, in training_step
    loss = self.compute_loss(model, inputs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\utils\trainer.py", line 118, in compute_loss
    outputs = model(**model_inputs)
              ^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1778, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1789, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\peft\peft_model.py", line 1326, in forward
    return self.base_model(
           ^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1778, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1789, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\peft\tuners\tuners_utils.py", line 161, in forward
    return self.model.forward(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\utils\model_wrapper.py", line 104, in forward
    return self.model(**model_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1778, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1789, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Vovan\.cache\huggingface\modules\transformers_modules\deepseek-ai\DeepSeek-OCR\9f30c71f441d010e5429c532364a86705536c53a\modeling_deepseekocr.py", line 565, in forward
    outputs  = self.model(
               ^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1778, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1789, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Vovan\.cache\huggingface\modules\transformers_modules\deepseek-ai\DeepSeek-OCR\9f30c71f441d010e5429c532364a86705536c53a\modeling_deepseekocr.py", line 422, in forward
    local_features_1 = sam_model(patches)
                       ^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1778, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1789, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Vovan\.cache\huggingface\modules\transformers_modules\deepseek-ai\DeepSeek-OCR\9f30c71f441d010e5429c532364a86705536c53a\deepencoder.py", line 699, in forward
    x = self.patch_embed(x)
        ^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1778, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1789, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Vovan\.cache\huggingface\modules\transformers_modules\deepseek-ai\DeepSeek-OCR\9f30c71f441d010e5429c532364a86705536c53a\deepencoder.py", line 999, in forward
    x = self.proj(x)
        ^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1778, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1789, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\conv.py", line 553, in forward
    return self._conv_forward(input, self.weight, self.bias)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\conv.py", line 548, in _conv_forward
    return F.conv2d(
           ^^^^^^^^^
RuntimeError: Input type (float) and bias type (struct c10::Half) should be the same
2026-01-10 20:03:01 - train_lora - ERROR - Ошибка: Input type (float) and bias type (struct c10::Half) should be the same
Traceback (most recent call last):
  File "C:\DSOCR-HW\scripts\train_lora.py", line 83, in main
    trainer.train()
  File "C:\DSOCR-HW\utils\trainer.py", line 508, in train
    self.trainer.train()
  File "C:\DSOCR-HW\venv\Lib\site-packages\transformers\trainer.py", line 2052, in train
    return inner_training_loop(
           ^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\transformers\trainer.py", line 2388, in _inner_training_loop
    tr_loss_step = self.training_step(model, inputs)
                   ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\transformers\trainer.py", line 3485, in training_step
    loss = self.compute_loss(model, inputs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\utils\trainer.py", line 118, in compute_loss
    outputs = model(**model_inputs)
              ^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1778, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1789, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\peft\peft_model.py", line 1326, in forward
    return self.base_model(
           ^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1778, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1789, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\peft\tuners\tuners_utils.py", line 161, in forward
    return self.model.forward(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\utils\model_wrapper.py", line 104, in forward
    return self.model(**model_kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1778, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1789, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Vovan\.cache\huggingface\modules\transformers_modules\deepseek-ai\DeepSeek-OCR\9f30c71f441d010e5429c532364a86705536c53a\modeling_deepseekocr.py", line 565, in forward
    outputs  = self.model(
               ^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1778, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1789, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Vovan\.cache\huggingface\modules\transformers_modules\deepseek-ai\DeepSeek-OCR\9f30c71f441d010e5429c532364a86705536c53a\modeling_deepseekocr.py", line 422, in forward
    local_features_1 = sam_model(patches)
                       ^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1778, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1789, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Vovan\.cache\huggingface\modules\transformers_modules\deepseek-ai\DeepSeek-OCR\9f30c71f441d010e5429c532364a86705536c53a\deepencoder.py", line 699, in forward
    x = self.patch_embed(x)
        ^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1778, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1789, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\Users\Vovan\.cache\huggingface\modules\transformers_modules\deepseek-ai\DeepSeek-OCR\9f30c71f441d010e5429c532364a86705536c53a\deepencoder.py", line 999, in forward
    x = self.proj(x)
        ^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1778, in _wrapped_call_impl
    return self._call_impl(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\module.py", line 1789, in _call_impl
    return forward_call(*args, **kwargs)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\conv.py", line 553, in forward
    return self._conv_forward(input, self.weight, self.bias)
           ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
  File "C:\DSOCR-HW\venv\Lib\site-packages\torch\nn\modules\conv.py", line 548, in _conv_forward
    return F.conv2d(
           ^^^^^^^^^
RuntimeError: Input type (float) and bias type (struct c10::Half) should be the same
